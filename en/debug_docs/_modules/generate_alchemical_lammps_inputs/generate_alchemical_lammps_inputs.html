<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs &#8212; Generate Alchemical LAMMPS Inputs 0.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/ntd2d.css?v=c867aedc" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=525cde36"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   

  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-3.6.2.min.js" type="text/javascript" defer="defer"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Generate Alchemical LAMMPS Inputs 0.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Functions to generate LAMMPS inputs for alchemical calculations.</span>

<span class="sd">For clarity, we would like to distinguish the difference between :math:`\lambda` and :math:`\lambda&#39;` (or :math:`\lambda_2`). We refer to :math:`\lambda` as</span>
<span class="sd">the scaling factor on the potential energy of the equilibrated system, so that when this value is changed, the system undergoes another equilibration</span>
<span class="sd">step. On the other hand, :math:`\lambda&#39;` is the value used to scale the potentials despite those the configurations being equilibrated</span>
<span class="sd">for a different value of :math:`\lambda`. The value of :math:`\lambda&#39;` is used in two instances. First, in thermodynamic integration (TI), values of :math:`\lambda&#39;`</span>
<span class="sd">that are very close to :math:`\lambda` can be used to calculate the derivative of the free energy with respect to :math:`\lambda`. This is</span>
<span class="sd">needed because LAMMPS does not compute explicit derivatives, although one should check whether they can derive an explicit expression, they cannot for changes of</span>
<span class="sd">:math:`\lambda&#39;` in the soft Lennard-Jones (LJ) potential.</span>

<span class="sd">Because generating LAMMPS input files can be cumbersome, functions have been included to generate the appropriate sections. If a linear approximation</span>
<span class="sd">can be made to calculate :math:`U_{\lambda,\lambda&#39;}` from :math:`U_{\lambda}` in post-processing, we recommend using</span>
<span class="sd">:func:`generate_input_linear_approximation()`. If a linear approximation cannot be made (such as changing</span>
<span class="sd">:math:`\lambda` in the soft-LJ potential) we recommend running a loop over all values of :math:`\lambda` saving frames spaced to be</span>
<span class="sd">independent samples, and an output file with small perturbations in :math:`\lambda&#39;` to calculate the derivative for TI in</span>
<span class="sd">post-processing. This is achieved with :func:`generate_traj_input()`. After this first simulation, we then</span>
<span class="sd">recommend the files needed for MBAR are generated using the `rerun &lt;https://docs.lammps.org/rerun.html&gt;`_ feature in LAMMPS.</span>
<span class="sd">Breaking up the computation like this will allow one to add additional points to their MBAR analysis without repeating the</span>
<span class="sd">points from an initial simulation. Generating the file for a rerun is achieved with</span>
<span class="sd">:func:`generate_rerun_mbar()`.</span>

<span class="sd">Notice that the output files do not contain the header information expected</span>
<span class="sd">in LAMMPS as that is system specific and left to the user.</span>

<span class="sd">Note that in LAMMPS, `fix adapt/fep &lt;https://docs.lammps.org/fix_adapt_fep.html&gt;`_ changes values of :math:`\lambda` and</span>
<span class="sd">`compute fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ changes values of :math:`\lambda&#39;`.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">_check_fix_adapt_changes_format</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that the input list describes a valid LAMMPS input</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fix_adapt_changes : list</span>
<span class="sd">        A list of lists containing the following information from `fix adapt/fep &lt;https://docs.lammps.org/fix_adapt_fep.html&gt;`_:</span>
<span class="sd">        attribute (str), args (tuple). This option is useful when a parameter that has been varied and is set to another value</span>
<span class="sd">        in this simulation, e.g., lambda when the Coulomb potential is set to zero. Using this feature avoids complications</span>
<span class="sd">        with writing the pair potential information in the data file. The attributes supported in LAMMPS are:</span>

<span class="sd">        - pair; arguments are: pair_style parameter solvent_type(s) solute_type(s)</span>

<span class="sd">            - pair_style (str) : String of LAMMPS pair style being changes</span>
<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_</span>
<span class="sd">              for the options in your pair-potential</span>
<span class="sd">            - solvent_type (str) : String defining atom types in the solvent (no spaces), lists are denoted with an asterisk</span>
<span class="sd">            - solute_type (str) : String defining atom types in the solute (no spaces), lists are denoted with an asterisk</span>

<span class="sd">        - atom; arguments are: parameter atom_type(s). These lines will be scaled by the variation of a &quot;lambda&quot; parameter</span>
<span class="sd">            whose range is defined in `parameter_range`, where the starting and end points are multiplied by ``variable_initial``.</span>

<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">            - atom_type (str) : String defining atom types being affected, lists are denoted with an asterisk</span>
<span class="sd">            - variable_initial (float) : Specify the initial value of the variable</span>

<span class="sd">        - kspace; arguments are: None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fix_adapt_changes is expected to be a list.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fix_adapt_changes</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;fix_adapt_changes is expected to be to be a list of iterables of length two, containing&quot;</span>
            <span class="s2">&quot; an attribute defined by a str and an iterable containing the appropriate keywords.&quot;</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">fix_adapt_changes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;kspace&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">No arguments should be given for attribute: kspace&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Four arguments should be given for attribute: pair; pair_style, parameter, solvent_type, and solute_type&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">attribute</span><span class="p">,</span> <span class="n">args</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Three arguments should be given for attribute: atom;  atom_type, variable_initial&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">attribute</span><span class="p">,</span> <span class="n">args</span>
                    <span class="p">)</span>
                <span class="p">)</span>


<div class="viewcode-block" id="generate_input_linear_approximation"><a class="viewcode-back" href="../../_autosummary/generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs.generate_input_linear_approximation.html#generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs.generate_input_linear_approximation">[docs]</a><span class="k">def</span> <span class="nf">generate_input_linear_approximation</span><span class="p">(</span>
    <span class="n">parameter_range</span><span class="p">,</span>
    <span class="n">parameter_change</span><span class="p">,</span>
    <span class="n">fix_adapt_changes</span><span class="p">,</span>
    <span class="n">temperature</span><span class="p">,</span>
    <span class="n">types_solute</span><span class="p">,</span>
    <span class="n">types_solvent</span><span class="p">,</span>
    <span class="n">n_run_equil_steps</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
    <span class="n">n_run_prod_steps</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
    <span class="n">output_frequency</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fix_adapt_changes2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parameter2_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">is_charged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">parameter_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Outputs the section of a LAMMPS input file that separates the Coulomb, nonbonded, and bond/angle/torsional contributions</span>
<span class="sd">    of the solute and solvent. As long as the parameter being changed is linearly dependent on the potential energy, these files for</span>
<span class="sd">    each value of the parameter can be used for thermodynamic integration (TI) or multi-state Bennett acceptance ratio (MBAR).</span>

<span class="sd">    The input data file for this script should be an equilibrated frame in the NPT ensemble. Notice that the input file contains</span>
<span class="sd">    the following keywords that you might replace with the values for your simulation using `sed`: TEMP, PRESS</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_range : list[float]</span>
<span class="sd">        Range of parameter values to be changed where the first value should be the value with which the system has been</span>
<span class="sd">        equilibrated.</span>
<span class="sd">    parameter_change : float</span>
<span class="sd">        The size of the step between parameter values, where a positive value increases and a negative value decreases.</span>
<span class="sd">        Take care that number of points needed to traverse the given range should result in an integer, otherwise</span>
<span class="sd">        LAMMPS will not end at the desired value.</span>
<span class="sd">    fix_adapt_changes : list</span>
<span class="sd">        A list of lists containing the following information from `fix adapt/fep &lt;https://docs.lammps.org/fix_adapt_fep.html&gt;`_:</span>
<span class="sd">        attribute (str), args (tuple), e.g., [[&quot;pair&quot;, (&quot;lj/cut/soft&quot;, &quot;lambda&quot;, 1, 2)]]. The attributes supported in LAMMPS are:</span>

<span class="sd">        - pair; arguments are: pair_style parameter solvent_type(s) solute_type(s)</span>

<span class="sd">            - pair_style (str) : String of LAMMPS pair style being changes</span>
<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">            - solvent_type (str) : String defining atom types in the solvent (no spaces), lists are denoted with an asterisk</span>
<span class="sd">            - solute_type (str) : String defining atom types in the solute (no spaces), lists are denoted with an asterisk</span>

<span class="sd">        - atom; arguments are: parameter atom_type(s). These lines will be scaled by the variation of a &quot;lambda&quot; parameter</span>
<span class="sd">            whose range is defined in `parameter_range`, where the starting and end points are multiplied by ``variable_initial``.</span>

<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">            - atom_type (str) : String defining atom types being affected, lists are denoted with an asterisk</span>
<span class="sd">            - variable_initial (float) : Specify the initial value of the variable</span>

<span class="sd">    temperature : float</span>
<span class="sd">        Temperature of the simulation. This will create a variable that is used in the FEP computes.</span>
<span class="sd">    types_solvent : str</span>
<span class="sd">        String defining all atom types in the solvent (no spaces) with lists defined using colons</span>
<span class="sd">    types_solute : str</span>
<span class="sd">        String defining all atom types in the solute (no spaces) with lists defined using colons</span>
<span class="sd">    n_run_equil_steps : int, default=1000000</span>
<span class="sd">        Number of steps in each equilibration run, first with a ramp from the old lambda value to the new value and then for</span>
<span class="sd">        equilibration at the new value. The total number of time steps taken per step in lambda (i.e., window) is</span>
<span class="sd">        2*n_run_equil_steps + n_run_prod_steps</span>
<span class="sd">    n_run_prod_steps : int, default=1000000</span>
<span class="sd">        Number of steps in each production run. The total number of time steps taken per step in lambda (i.e., window) is</span>
<span class="sd">        2*n_run_equil_steps + n_run_prod_steps</span>
<span class="sd">    output_frequency : int, default=1000</span>
<span class="sd">        Number of steps between thermo output and dump output.</span>
<span class="sd">    output_file : str, default=None</span>
<span class="sd">        File name and path for optional output file</span>
<span class="sd">    fix_adapt_changes2 : list, default=[]</span>
<span class="sd">        A list of lists containing the following information from `fix adapt/fep &lt;https://docs.lammps.org/fix_adapt_fep.html&gt;`_:</span>
<span class="sd">        attribute (str), args (tuple). This option is useful when a parameter that has been varied and is set to another value</span>
<span class="sd">        in this simulation, e.g., lambda when the Coulomb potential is set to zero. Using this feature avoids complications</span>
<span class="sd">        with writing the pair potential information in the data file. The attributes supported in LAMMPS are:</span>

<span class="sd">        - pair; arguments are: pair_style parameter solvent_type(s) solute_type(s)</span>

<span class="sd">            - pair_style (str) : String of LAMMPS pair style being changes</span>
<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_</span>
<span class="sd">              for the options in your pair-potential</span>
<span class="sd">            - solvent_type (str) : String defining atom types in the solvent (no spaces), lists are denoted with an asterisk</span>
<span class="sd">            - solute_type (str) : String defining atom types in the solute (no spaces), lists are denoted with an asterisk</span>

<span class="sd">        - atom; arguments are: parameter atom_type(s). These lines will be scaled by the variation of a &quot;lambda&quot; parameter</span>
<span class="sd">            whose range is defined in `parameter_range`, where the starting and end points are multiplied by ``variable_initial``.</span>

<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options such as &quot;charge&quot;</span>
<span class="sd">            - atom_type (str) : String defining atom types being affected, lists are denoted with an asterisk</span>
<span class="sd">            - variable_initial (float) : Specify the initial value of the variable</span>

<span class="sd">    parameter2_value : str, default=None</span>
<span class="sd">        Value to set ``parameter2`` in ``fix_adapt_changes2``.</span>
<span class="sd">    is_charged : bool, default=True</span>
<span class="sd">        This will add kspace components to the record of free energy changes</span>
<span class="sd">    parameter_array : list, default=None</span>
<span class="sd">        If not ``None``, this argument will overwrite the ``parameter_change`` argument and use the specified steps in</span>
<span class="sd">        the parameter. Note that the first value should represent the state that the trajectory is equilibrated at.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    file : list[str]</span>
<span class="sd">        List of strings representing lines in a file</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">parameter_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">parameter_change</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">parameter_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">parameter_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parameter_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parameter_change</span><span class="p">),</span> <span class="p">[</span><span class="n">parameter_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="p">)</span>
        <span class="n">flag_array</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parameter_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parameter_array</span><span class="p">)</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parameter_array</span><span class="p">]))</span>
        <span class="n">flag_array</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">nblocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nblocks</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">flag_array</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;If `parameter_array is not None`, an array of parameters must be provided, instead of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">parameter_array</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The argument `parameter_change` must be appropriately positive or negative to span the `parameter_range`&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">parameter2_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If fix_adapt_changes2 is provided, so must parameter2_value&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parameter2_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If parameter2_value is provided, so must fix_adapt_changes2&quot;</span><span class="p">)</span>

    <span class="n">_check_fix_adapt_changes_format</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="s2">&quot;kspace&quot;</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">_check_fix_adapt_changes_format</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">parameter2_value</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;kspace&quot;</span>

    <span class="n">file</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Variables and System Conditions</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable TK equal </span><span class="si">{</span><span class="n">temperature</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable freq equal </span><span class="si">{</span><span class="n">output_frequency</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable runtime_equil equal </span><span class="si">{</span><span class="n">n_run_equil_steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable runtime_prod equal </span><span class="si">{</span><span class="n">n_run_prod_steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable pinst equal press</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable tinst equal temp</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable vinst equal vol</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable pe equal pe</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable nblocks equal </span><span class="si">{</span><span class="n">nblocks</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable lambdas vector [</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">decimals</span><span class="o">=</span><span class="n">prec</span><span class="p">))</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameter_array</span><span class="p">])</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;thermo $</span><span class="si">{freq}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Group atoms</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;group solute type </span><span class="si">{</span><span class="n">types_solute</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;group solvent type </span><span class="si">{</span><span class="n">types_solvent</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Set-up Loop</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable runid loop 1 $</span><span class="si">{nblocks}</span><span class="s2"> pad</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    label runloop1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    # Adjust param for the box and equilibrate</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    variable param equal v_lambdas[v_runid]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;    if &quot;$</span><span class="si">{runid}</span><span class="s1"> == 1&quot; then &amp;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;        &quot;jump SELF skipequil&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s2">&quot;    variable ind equal v_runid-1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    variable param0 equal v_lambdas[v_ind]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    variable paramramp equal ramp(v_param0,v_param)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable deltacdmA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_deltacdm</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable deltacdm2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">*v_deltacdm</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable deltacdm2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal -</span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">*v_deltacdm</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    variable paramrampA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*ramp(v_param0,v_param)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    variable paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_param</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Add previously changed parameter if it exists</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Set Previous Change</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;variable param2 equal </span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable param2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_param2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fix ADAPT2 all adapt/fep 1 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                    <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param2 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    fix ADAPT all adapt/fep 1 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_paramrampA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_paramramp &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;    thermo_style custom step v_paramramp &quot;</span>
            <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;v_paramrampA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">)</span> <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    run $</span><span class="si">{runtime_equil}</span><span class="s2"> # Run Ramp</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    unfix ADAPT</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    fix ADAPT all adapt/fep $</span><span class="si">{freq}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;    thermo_style custom step v_param &quot;</span>
            <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;v_paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">)</span> <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot; temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    run $</span><span class="si">{runtime_equil}</span><span class="s2"> # Run Equil</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    label skipequil</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    write_data files/</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="s2">.data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    write_data files/</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">.data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    # Initialize computes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    thermo_style custom step v_param temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    ## Compute PE for contributions for bonds, angles, dihedrals, and impropers</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    compute pe_solute_1 solute pe/atom bond angle dihedral improper # PE from nonpair/noncharged intramolecular interactions</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    compute pe_solvent_1 solvent pe/atom bond angle dihedral improper # PE from nonpair/noncharged intramolecular interactions</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    compute pe_solute_bond solute reduce sum c_pe_solute_1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    compute pe_solvent_bond solvent reduce sum c_pe_solvent_1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    ## Compute PE for contributions for pair (Includes real space component of coul)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    compute pe_solute_pair solute group/group solute pair yes kspace no</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    compute pe_solvent_pair solvent group/group solvent pair yes kspace no</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    compute pe_inter_pair solute group/group solvent pair yes kspace no</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_charged</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;    ## Compute PE for contributions for kspace component </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;    compute pe_solute_kspace solute group/group solute pair no kspace yes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;    compute pe_solvent_kspace solvent group/group solvent pair no kspace yes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;    compute pe_inter_kspace solute group/group solvent pair no kspace yes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;    thermo_style custom step v_param temp press pe evdwl enthalpy &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        c_pe_solute_bond c_pe_solute_pair c_pe_solute_kspace &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        c_pe_solvent_bond c_pe_solvent_pair c_pe_solvent_kspace &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        c_pe_inter_pair c_pe_inter_kspace</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;    thermo_style custom step v_param temp press pe evdwl enthalpy &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        c_pe_solute_bond c_pe_solute_pair &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        c_pe_solvent_bond c_pe_solvent_pair &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        c_pe_inter_pair</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    fix FEPout all ave/time $</span><span class="si">{freq}</span><span class="s2"> 1 $</span><span class="si">{freq}</span><span class="s2"> v_param v_param2 v_tinst v_pinst v_vinst v_pe &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    fix FEPout all ave/time $</span><span class="si">{freq}</span><span class="s2"> 1 $</span><span class="si">{freq}</span><span class="s2"> v_param v_tinst v_pinst v_vinst v_pe &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_charged</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;        c_pe_solute_bond c_pe_solute_pair c_pe_solute_kspace &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        c_pe_solvent_bond c_pe_solvent_pair c_pe_solvent_kspace &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        c_pe_inter_pair c_pe_inter_kspace &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;        c_pe_solute_bond c_pe_solute_pair &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        c_pe_solvent_bond c_pe_solvent_pair &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        c_pe_inter_pair &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        file files/linear_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="s2">.txt</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        file files/linear_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">.txt</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    run $</span><span class="si">{runtime_prod}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute pe_solute_bond</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute pe_solute_1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute pe_solvent_bond</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute pe_solvent_1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute pe_solute_pair</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute pe_solvent_pair</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute pe_inter_pair</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_charged</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;    uncompute pe_solute_kspace</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;    uncompute pe_solvent_kspace</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;    uncompute pe_inter_kspace</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s1">&#39;    if &quot;$</span><span class="si">{runid}</span><span class="s1"> != 1&quot; then &amp;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;        &quot;unfix ADAPT&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s2">&quot;    unfix FEPout</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    next runid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    jump SELF runloop1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;thermo_style custom v_param temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;write_data final.data nocoeff</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;unfix ADAPT2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file</span></div>


<div class="viewcode-block" id="generate_traj_input"><a class="viewcode-back" href="../../_autosummary/generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs.generate_traj_input.html#generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs.generate_traj_input">[docs]</a><span class="k">def</span> <span class="nf">generate_traj_input</span><span class="p">(</span>
    <span class="n">parameter_range</span><span class="p">,</span>
    <span class="n">parameter_change</span><span class="p">,</span>
    <span class="n">fix_adapt_changes</span><span class="p">,</span>
    <span class="n">temperature</span><span class="p">,</span>
    <span class="n">n_run_equil_steps</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
    <span class="n">n_run_prod_steps</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
    <span class="n">output_frequency</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">del_parameter</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fix_adapt_changes2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parameter2_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parameter_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Outputs the section of a LAMMPS input file that loops over the values of parameter being changed (e.g., lambda)</span>
<span class="sd">    Small perturbations in the potential energy are also output so that the derivative can be calculated for thermodynamic</span>
<span class="sd">    integration. Trajectories are produces so that files for MBAR analysis may be generated in post-processing.</span>

<span class="sd">    The input data file for this script should be an equilibrated frame in the NPT ensemble. Notice that the input file contains</span>
<span class="sd">    the following keywords that you might replace with the values for your simulation using `sed`: TEMP, PRESS</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_range : list[float]</span>
<span class="sd">        Range of parameter values to be changed where the first value should be the value with which the system has been</span>
<span class="sd">        equilibrated.</span>
<span class="sd">    parameter_change : float</span>
<span class="sd">        The size of the step between parameter values, where a positive value increases and a negative value decreases.</span>
<span class="sd">        Take care that number of points needed to traverse the given range should result in an integer, otherwise</span>
<span class="sd">        LAMMPS will not end at the desired value.</span>
<span class="sd">    fix_adapt_changes : list</span>
<span class="sd">        A list of lists containing the following information from `fix adapt/fep &lt;https://docs.lammps.org/fix_adapt_fep.html&gt;`_:</span>
<span class="sd">        attribute (str), args (tuple), e.g., [[&quot;pair&quot;, (&quot;lj/cut/soft&quot;, &quot;lambda&quot;, 1, 2)]]. The attributes supported in LAMMPS are:</span>

<span class="sd">        - pair; arguments are: pair_style parameter solvent_type(s) solute_type(s)</span>

<span class="sd">            - pair_style (str) : String of LAMMPS pair style being changes</span>
<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">            - solvent_type (str) : String defining atom types in the solvent (no spaces), lists are denoted with an asterisk</span>
<span class="sd">            - solute_type (str) : String defining atom types in the solute (no spaces), lists are denoted with an asterisk</span>

<span class="sd">        - atom; arguments are: parameter atom_type(s). These lines will be scaled by the variation of a &quot;lambda&quot; parameter</span>
<span class="sd">            whose range is defined in `parameter_range`, where the starting and end points are multiplied by ``variable_initial``.</span>

<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">            - atom_type (str) : String defining atom types being affected, lists are denoted with an asterisk</span>
<span class="sd">            - variable_initial (float) : Specify the initial value of the variable</span>

<span class="sd">    temperature : float</span>
<span class="sd">        Temperature of the simulation. This will create a variable that is used in the FEP computes.</span>
<span class="sd">    n_run_equil_steps : int, default=1000000</span>
<span class="sd">        Number of steps in each equilibration run, first with a ramp from the old lambda value to the new value and then for</span>
<span class="sd">        equilibration at the new value. The total number of time steps taken per step in lambda (i.e., window) is</span>
<span class="sd">        2*n_run_equil_steps + n_run_prod_steps</span>
<span class="sd">    n_run_prod_steps : int, default=1000000</span>
<span class="sd">        Number of steps in each production run. The total number of time steps taken per step in lambda (i.e., window) is</span>
<span class="sd">        2*n_run_equil_steps + n_run_prod_steps</span>
<span class="sd">    output_frequency : int, default=1000</span>
<span class="sd">        Number of steps between thermo output and dump output.</span>
<span class="sd">    del_parameter : float, default=0.01</span>
<span class="sd">        Change used to calculate the forward and backward difference used to compute the derivative through a central difference</span>
<span class="sd">        approximation.</span>
<span class="sd">    output_file : str, default=None</span>
<span class="sd">        File name and path for optional output file</span>
<span class="sd">    fix_adapt_changes2 : list, default=None</span>
<span class="sd">        A list of lists containing the following information from `fix adapt/fep &lt;https://docs.lammps.org/fix_adapt_fep.html&gt;`_:</span>
<span class="sd">        attribute (str), args (tuple). This option is useful when a parameter that has been varied and is set to another value</span>
<span class="sd">        in this simulation, e.g., lambda when the Coulomb potential is set to zero. Using this feature avoids complications</span>
<span class="sd">        with writing the pair potential information in the data file. The attributes supported in LAMMPS are:</span>

<span class="sd">        - pair; arguments are: pair_style parameter solvent_type(s) solute_type(s)</span>

<span class="sd">            - pair_style (str) : String of LAMMPS pair style being changes</span>
<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_</span>
<span class="sd">              for the options in your pair-potential</span>
<span class="sd">            - solvent_type (str) : String defining atom types in the solvent (no spaces), lists are denoted with an asterisk</span>
<span class="sd">            - solute_type (str) : String defining atom types in the solute (no spaces), lists are denoted with an asterisk</span>

<span class="sd">        - atom; arguments are: parameter atom_type(s). These lines will be scaled by the variation of a &quot;lambda&quot; parameter</span>
<span class="sd">            whose range is defined in `parameter_range`, where the starting and end points are multiplied by ``variable_initial``.</span>

<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options such as &quot;charge&quot;</span>
<span class="sd">            - atom_type (str) : String defining atom types being affected, lists are denoted with an asterisk</span>
<span class="sd">            - variable_initial (float) : Specify the initial value of the variable</span>

<span class="sd">    parameter2_value : float, default=None</span>
<span class="sd">        Value to set ``parameter2`` in ``fix_adapt_changes2``. Parameter that has been varied and is set to another value in this simulation, e.g., lambda when the Coulomb potential</span>
<span class="sd">        is set to zero. Using this feature avoids complications with writing the pair potential information in the data file.</span>
<span class="sd">        See table in `compute fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">    parameter_array : list, default=None</span>
<span class="sd">        If not ``None``, this argument will overwrite the ``parameter_change`` argument and use the specified steps in</span>
<span class="sd">        the parameter. Note that the first value should represent the state that the trajectory is equilibrated at.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    file : list[str]</span>
<span class="sd">        List of strings representing lines in a file</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">del_parameter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">del_parameter</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">parameter_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">parameter_change</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">parameter_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">parameter_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parameter_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parameter_change</span><span class="p">),</span> <span class="p">[</span><span class="n">parameter_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="p">)</span>
        <span class="n">flag_array</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parameter_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parameter_array</span><span class="p">)</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parameter_array</span><span class="p">]))</span>
        <span class="n">flag_array</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">nblocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nblocks</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">flag_array</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;If `parameter_array is not None`, an array of parameters must be provided, instead of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">parameter_array</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The argument `parameter_change` must be appropriately positive or negative to span the `parameter_range`&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">parameter2_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If fix_adapt_changes2 is provided, so must parameter2_value&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parameter2_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If parameter2_value is provided, so must fix_adapt_changes2&quot;</span><span class="p">)</span>

    <span class="n">_check_fix_adapt_changes_format</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="s2">&quot;kspace&quot;</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">_check_fix_adapt_changes_format</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">parameter2_value</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;kspace&quot;</span>

    <span class="n">file</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Variables and System Conditions</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable TK equal </span><span class="si">{</span><span class="n">temperature</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable freq equal </span><span class="si">{</span><span class="n">output_frequency</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable runtime_equil equal </span><span class="si">{</span><span class="n">n_run_equil_steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable runtime_prod equal </span><span class="si">{</span><span class="n">n_run_prod_steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable pinst equal press</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable tinst equal temp</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable vinst equal vol</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable pe equal pe</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable deltacdm equal </span><span class="si">{</span><span class="n">del_parameter</span><span class="si">}</span><span class="s2"> # delta used in central different method for derivative in TI</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable deltacdm2 equal -</span><span class="si">{</span><span class="n">del_parameter</span><span class="si">}</span><span class="s2"> # delta used in central different method for derivative in TI</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable nblocks equal </span><span class="si">{</span><span class="n">nblocks</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable lambdas vector [</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">decimals</span><span class="o">=</span><span class="n">prec</span><span class="p">))</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameter_array</span><span class="p">])</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;thermo $</span><span class="si">{freq}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Set-up Loop</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable runid loop 1 $</span><span class="si">{nblocks}</span><span class="s2"> pad</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    label runloop1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    # Adjust param for the box and equilibrate</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    variable param equal v_lambdas[v_runid]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;    if &quot;$</span><span class="si">{runid}</span><span class="s1"> == 1&quot; then &amp;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;        &quot;jump SELF skipequil&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s2">&quot;    variable ind equal v_runid-1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    variable param0 equal v_lambdas[v_ind]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    variable paramramp equal ramp(v_param0,v_param)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable deltacdmA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_deltacdm</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable deltacdm2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">*v_deltacdm</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable deltacdm2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal -</span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">*v_deltacdm</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    variable paramrampA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*ramp(v_param0,v_param)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    variable paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_param</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Add previously changed parameter if it exists</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Set Previous Change</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;variable param2 equal </span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable param2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_param2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fix ADAPT2 all adapt/fep 1 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                    <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param2 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    fix ADAPT all adapt/fep 1 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_paramrampA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_paramramp &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;    thermo_style custom step v_paramramp &quot;</span>
            <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;v_paramrampA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">)</span> <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    run $</span><span class="si">{runtime_equil}</span><span class="s2"> # Run Ramp</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    unfix ADAPT</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    fix ADAPT all adapt/fep $</span><span class="si">{freq}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;    thermo_style custom step v_param &quot;</span>
            <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;v_paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">)</span> <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot; temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    run $</span><span class="si">{runtime_equil}</span><span class="s2"> # Run Equil</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    label skipequil</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    write_data files/</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="s2">.data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;    write_data files/</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">.data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    # Initialize computes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    thermo_style custom step v_param temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    compute FEPdb all fep $</span><span class="si">{TK}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_deltacdm2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_deltacdm2 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        volume yes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    compute FEPdf all fep $</span><span class="si">{TK}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_deltacdmA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_deltacdm &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        volume yes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;    fix FEPout all ave/time $</span><span class="si">{freq}</span><span class="s2"> 1 $</span><span class="si">{freq}</span><span class="s2"> v_param v_deltacdm v_tinst v_pinst v_vinst v_pe &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;        c_FEPdb[1] c_FEPdf[1] file files/ti_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">.txt</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;    dump TRAJ all custom $</span><span class="si">{freq}</span><span class="s2"> &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;files/dump_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">.lammpstrj id mol type element xu yu zu</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;    fix FEPout all ave/time $</span><span class="si">{freq}</span><span class="s2"> 1 $</span><span class="si">{freq}</span><span class="s2"> v_param v_deltacdm v_param2 v_tinst v_pinst v_vinst v_pe &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;        c_FEPdb[1] c_FEPdf[1] file files/ti_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">_&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="s2">.txt</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;    dump TRAJ all custom $</span><span class="si">{freq}</span><span class="s2"> &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;files/dump_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">_&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="s2">.lammpstrj id mol type element xu yu zu</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    run $</span><span class="si">{runtime_prod}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute FEPdb</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute FEPdf</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s1">&#39;    if &quot;$</span><span class="si">{runid}</span><span class="s1"> != 1&quot; then &amp;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;        &quot;unfix ADAPT&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s2">&quot;    unfix FEPout</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    undump TRAJ</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    next runid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    jump SELF runloop1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;thermo_style custom v_param temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;write_data final.data nocoeff</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file</span></div>


<div class="viewcode-block" id="generate_mbar_input"><a class="viewcode-back" href="../../_autosummary/generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs.generate_mbar_input.html#generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs.generate_mbar_input">[docs]</a><span class="k">def</span> <span class="nf">generate_mbar_input</span><span class="p">(</span>
    <span class="n">parameter_range</span><span class="p">,</span>
    <span class="n">parameter_change</span><span class="p">,</span>
    <span class="n">fix_adapt_changes</span><span class="p">,</span>
    <span class="n">temperature</span><span class="p">,</span>
    <span class="n">del_parameter</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">n_run_equil_steps</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
    <span class="n">n_run_prod_steps</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
    <span class="n">output_frequency</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fix_adapt_changes2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parameter2_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dump</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">parameter_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Outputs the section of a LAMMPS input file that loops over the values of parameter being changed (e.g., lambda)</span>
<span class="sd">    Small perturbations in the potential energy are also output so that the derivative can be calculated for thermodynamic</span>
<span class="sd">    integration. Trajectories are produces so that files for MBAR analysis may be generated in post-processing.</span>

<span class="sd">    The input data file for this script should be an equilibrated frame in the NPT ensemble. Notice that the input file contains</span>
<span class="sd">    the following keywords that you might replace with the values for your simulation using `sed`: TEMP, PRESS</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_range : list[float]</span>
<span class="sd">        Range of parameter values to be changed where the first value should be the value with which the system has been</span>
<span class="sd">        equilibrated.</span>
<span class="sd">    parameter_change : float</span>
<span class="sd">        The size of the step between parameter values, where a positive value increases and a negative value decreases.</span>
<span class="sd">        Take care that number of points needed to traverse the given range should result in an integer, otherwise</span>
<span class="sd">        LAMMPS will not end at the desired value.</span>
<span class="sd">    fix_adapt_changes : list</span>
<span class="sd">        A list of lists containing the following information from `fix adapt/fep &lt;https://docs.lammps.org/fix_adapt_fep.html&gt;`_:</span>
<span class="sd">        attribute (str), args (tuple), e.g., [[&quot;pair&quot;, (&quot;lj/cut/soft&quot;, &quot;lambda&quot;, 1, 2)]]. The attributes supported in LAMMPS are:</span>

<span class="sd">        - pair; arguments are: pair_style parameter solvent_type(s) solute_type(s)</span>

<span class="sd">            - pair_style (str) : String of LAMMPS pair style being changes</span>
<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">            - solvent_type (str) : String defining atom types in the solvent (no spaces), lists are denoted with an asterisk</span>
<span class="sd">            - solute_type (str) : String defining atom types in the solute (no spaces), lists are denoted with an asterisk</span>

<span class="sd">        - atom; arguments are: parameter atom_type(s). These lines will be scaled by the variation of a &quot;lambda&quot; parameter</span>
<span class="sd">            whose range is defined in `parameter_range`, where the starting and end points are multiplied by ``variable_initial``.</span>

<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">            - atom_type (str) : String defining atom types being affected, lists are denoted with an asterisk</span>
<span class="sd">            - variable_initial (float) : Specify the initial value of the variable</span>

<span class="sd">    temperature : float</span>
<span class="sd">        Temperature of the simulation. This will create a variable that is used in the FEP computes.</span>
<span class="sd">    del_parameter : float, default=0.1</span>
<span class="sd">        Change used to calculate the forward and backward difference used to compute the derivative through a central difference</span>
<span class="sd">        approximation. Must be greater then zero.</span>
<span class="sd">    n_run_equil_steps : int, default=1000000</span>
<span class="sd">        Number of steps in each equilibration run, first with a ramp from the old lambda value to the new value and then for</span>
<span class="sd">        equilibration at the new value. The total number of time steps taken per step in lambda (i.e., window) is</span>
<span class="sd">        2*n_run_equil_steps + n_run_prod_steps</span>
<span class="sd">    n_run_prod_steps : int, default=1000000</span>
<span class="sd">        Number of steps in each production run. The total number of time steps taken per step in lambda (i.e., window) is</span>
<span class="sd">        2*n_run_equil_steps + n_run_prod_steps</span>
<span class="sd">    output_frequency : int, default=1000</span>
<span class="sd">        Number of steps between thermo output and dump output.</span>
<span class="sd">    output_file : str, default=None</span>
<span class="sd">        File name and path for optional output LAMMPS file, otherwise each line is returned as a list.</span>
<span class="sd">    fix_adapt_changes2 : list, default=None</span>
<span class="sd">        A list of lists containing the following information from `fix adapt/fep &lt;https://docs.lammps.org/fix_adapt_fep.html&gt;`_:</span>
<span class="sd">        attribute (str), args (tuple). This option is useful when a parameter that has been varied and is set to another value</span>
<span class="sd">        in this simulation, e.g., lambda when the Coulomb potential is set to zero. Using this feature avoids complications</span>
<span class="sd">        with writing the pair potential information in the data file. The attributes supported in LAMMPS are:</span>

<span class="sd">        - pair; arguments are: pair_style parameter solvent_type(s) solute_type(s)</span>

<span class="sd">            - pair_style (str) : String of LAMMPS pair style being changes</span>
<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_</span>
<span class="sd">              for the options in your pair-potential</span>
<span class="sd">            - solvent_type (str) : String defining atom types in the solvent (no spaces), lists are denoted with an asterisk</span>
<span class="sd">            - solute_type (str) : String defining atom types in the solute (no spaces), lists are denoted with an asterisk</span>

<span class="sd">        - atom; arguments are: parameter atom_type(s). These lines will be scaled by the variation of a &quot;lambda&quot; parameter</span>
<span class="sd">            whose range is defined in `parameter_range`, where the starting and end points are multiplied by ``variable_initial``.</span>

<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options such as &quot;charge&quot;</span>
<span class="sd">            - atom_type (str) : String defining atom types being affected, lists are denoted with an asterisk</span>
<span class="sd">            - variable_initial (float) : Specify the initial value of the variable</span>

<span class="sd">    parameter2_value : float, default=None</span>
<span class="sd">        Value to set ``parameter2`` in ``fix_adapt_changes2``. Parameter that has been varied and is set to another value in this simulation, e.g., lambda when the Coulomb potential</span>
<span class="sd">        is set to zero. Using this feature avoids complications with writing the pair potential information in the data file.</span>
<span class="sd">        See table in `compute fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">    dump : bool, default=False</span>
<span class="sd">        If True, trajectories are dumped for each ``parameter`` value.</span>
<span class="sd">    parameter_array : list, default=None</span>
<span class="sd">        If not ``None``, this argument will overwrite the ``parameter_change`` argument and use the specified steps in</span>
<span class="sd">        the parameter. Note that the first value should represent the state that the trajectory is equilibrated at.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    file : list[str]</span>
<span class="sd">        List of strings representing lines in a file</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">del_parameter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">del_parameter</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">parameter_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">parameter_change</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">parameter_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">parameter_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parameter_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parameter_change</span><span class="p">),</span> <span class="p">[</span><span class="n">parameter_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="p">)</span>
        <span class="n">flag_array</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parameter_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parameter_array</span><span class="p">)</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parameter_array</span><span class="p">]))</span>
        <span class="n">flag_array</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">nblocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nblocks</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">flag_array</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;If `parameter_array is not None`, an array of parameters must be provided, instead of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">parameter_array</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The argument `parameter_change` must be appropriately positive or negative to span the `parameter_range`&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">parameter2_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If fix_adapt_changes2 is provided, so must parameter2_value&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parameter2_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If parameter2_value is provided, so must fix_adapt_changes2&quot;</span><span class="p">)</span>

    <span class="n">_check_fix_adapt_changes_format</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="s2">&quot;kspace&quot;</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">_check_fix_adapt_changes_format</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">parameter2_value</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;kspace&quot;</span>

    <span class="n">file</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Variables and System Conditions</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable TK equal </span><span class="si">{</span><span class="n">temperature</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable freq equal </span><span class="si">{</span><span class="n">output_frequency</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable runtime_equil equal </span><span class="si">{</span><span class="n">n_run_equil_steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable runtime_prod equal </span><span class="si">{</span><span class="n">n_run_prod_steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable pinst equal press</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable tinst equal temp</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable vinst equal vol</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable pe equal pe</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable deltacdm equal </span><span class="si">{</span><span class="n">del_parameter</span><span class="si">}</span><span class="s2"> # delta used in central different method for derivative in TI</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable deltacdm2 equal -</span><span class="si">{</span><span class="n">del_parameter</span><span class="si">}</span><span class="s2"> # delta used in central different method for derivative in TI</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable nblocks equal </span><span class="si">{</span><span class="n">nblocks</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable lambdas vector [</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">decimals</span><span class="o">=</span><span class="n">prec</span><span class="p">))</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameter_array</span><span class="p">])</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;thermo $</span><span class="si">{freq}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Set-up Loop</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable runid loop 1 $</span><span class="si">{nblocks}</span><span class="s2"> pad</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    label runloop1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    # Adjust param for the box and equilibrate</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    variable param equal v_lambdas[v_runid]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;    if &quot;$</span><span class="si">{runid}</span><span class="s1"> == 1&quot; then &amp;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;        &quot;jump SELF skipequil&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s2">&quot;    variable ind equal v_runid-1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    variable param0 equal v_lambdas[v_ind]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    variable paramramp equal ramp(v_param0,v_param)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable deltacdmA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_deltacdm</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable deltacdm2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">*v_deltacdm</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable deltacdm2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal -</span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">*v_deltacdm</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    variable paramrampA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*ramp(v_param0,v_param)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    variable paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_param</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Add previously changed parameter if it exists</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Set Previous Change</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;variable param2 equal </span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable param2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_param2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fix ADAPT2 all adapt/fep 1 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                    <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param2 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    fix ADAPT all adapt/fep 1 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_paramrampA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_paramramp &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;    thermo_style custom step v_paramramp &quot;</span>
            <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;v_paramrampA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">)</span> <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    run $</span><span class="si">{runtime_equil}</span><span class="s2"> # Run Ramp</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    unfix ADAPT</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    fix ADAPT all adapt/fep $</span><span class="si">{freq}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;    thermo_style custom step v_param &quot;</span>
            <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;v_paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">)</span> <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot; temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    run $</span><span class="si">{runtime_equil}</span><span class="s2"> # Run Equil</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    label skipequil</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;    write_data files/</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">.data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    # Initialize computes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    thermo_style custom step v_param temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    compute FEPdb all fep $</span><span class="si">{TK}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_deltacdm2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_deltacdm2 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        volume yes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    compute FEPdf all fep $</span><span class="si">{TK}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_deltacdmA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_deltacdm &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        volume yes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;    fix FEPout all ave/time $</span><span class="si">{freq}</span><span class="s2"> 1 $</span><span class="si">{freq}</span><span class="s2"> v_param v_deltacdm v_tinst v_pinst v_vinst v_pe &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;        c_FEPdb[1] c_FEPdf[1] file files/ti_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">.txt</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;    fix FEPout all ave/time $</span><span class="si">{freq}</span><span class="s2"> 1 $</span><span class="si">{freq}</span><span class="s2"> v_param v_deltacdm v_param2 v_tinst v_pinst v_vinst v_pe &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;        c_FEPdb[1] c_FEPdf[1] file files/ti_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">_&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="s2">.txt</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># Write out the free energy difference between the current state and the other states</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nblocks</span><span class="p">):</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    variable delta</span><span class="si">{0:0d}</span><span class="s2"> equal &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;v_lambdas[</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">]-v_param</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;    variable deltaA</span><span class="si">{0:0d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*&quot;</span> <span class="o">+</span> <span class="s2">&quot;v_delta</span><span class="si">{0:0d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    compute FEP</span><span class="si">{0:03d}</span><span class="s2"> all fep &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{TK}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="s2">&quot;v_deltaA</span><span class="si">{0:0d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                    <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
                <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="s2">&quot;v_delta</span><span class="si">{0:0d}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;        volume yes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;    variable param</span><span class="si">{0:03d}</span><span class="s2"> equal v_param+v_delta</span><span class="si">{0:0d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;    fix FEPout</span><span class="si">{0:03d}</span><span class="s2"> all&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot; ave/time $</span><span class="si">{freq}</span><span class="s2"> 1 $</span><span class="si">{freq}</span><span class="s2"> &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;v_param v_param</span><span class="si">{0:03d}</span><span class="s2"> v_param2 v_pe &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="s2">&quot;        c_FEP</span><span class="si">{0:03d}</span><span class="s2">[1] c_FEP</span><span class="si">{0:03d}</span><span class="s2">[2] c_FEP</span><span class="si">{0:03d}</span><span class="s2">[3]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; file files/mbar_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;_$</span><span class="si">{param}</span><span class="s2">_${param&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:03d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="o">+</span> <span class="s2">&quot;}_&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name2</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;    fix FEPout</span><span class="si">{0:03d}</span><span class="s2"> all&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot; ave/time $</span><span class="si">{freq}</span><span class="s2"> 1 $</span><span class="si">{freq}</span><span class="s2"> &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;v_param v_param</span><span class="si">{0:03d}</span><span class="s2"> v_pe &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="s2">&quot;        c_FEP</span><span class="si">{0:03d}</span><span class="s2">[1] c_FEP</span><span class="si">{0:03d}</span><span class="s2">[2] c_FEP</span><span class="si">{0:03d}</span><span class="s2">[3]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; file files/mbar_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;_$</span><span class="si">{param}</span><span class="s2">_${param&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:03d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="o">+</span> <span class="s2">&quot;}.txt</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;    dump TRAJ all custom $</span><span class="si">{freq}</span><span class="s2"> &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;files/dump_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">.lammpstrj id mol type element xu yu zu</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;    dump TRAJ all custom $</span><span class="si">{freq}</span><span class="s2"> &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;files/dump_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">_&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="s2">.lammpstrj id mol type element xu yu zu</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    run $</span><span class="si">{runtime_prod}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute FEPdb</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    uncompute FEPdf</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s1">&#39;    if &quot;$</span><span class="si">{runid}</span><span class="s1"> != 1&quot; then &amp;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;        &quot;unfix ADAPT&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nblocks</span><span class="p">):</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;    uncompute FEP</span><span class="si">{0:03d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                <span class="s2">&quot;    unfix FEPout</span><span class="si">{0:03d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;    unfix FEPout</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    undump TRAJ</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    next runid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;    jump SELF runloop1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;thermo_style custom v_param temp press pe evdwl enthalpy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;write_data final.data nocoeff</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dump</span><span class="p">:</span>  <span class="c1"># Comment out trajectroy lines</span>
        <span class="n">file</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">if</span> <span class="s2">&quot;TRAJ&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">file</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file</span></div>


<div class="viewcode-block" id="generate_rerun_mbar"><a class="viewcode-back" href="../../_autosummary/generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs.generate_rerun_mbar.html#generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs.generate_rerun_mbar">[docs]</a><span class="k">def</span> <span class="nf">generate_rerun_mbar</span><span class="p">(</span>
    <span class="n">parameter_value</span><span class="p">,</span>
    <span class="n">parameter_range</span><span class="p">,</span>
    <span class="n">parameter_change</span><span class="p">,</span>
    <span class="n">fix_adapt_changes</span><span class="p">,</span>
    <span class="n">temperature</span><span class="p">,</span>
    <span class="n">output_frequency</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fix_adapt_changes2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parameter2_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parameter_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Outputs the section of a LAMMPS input file that reruns trajectories for different lambda values and calculates</span>
<span class="sd">    the potential energy for all other lambda values with this set of configurations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_value : float</span>
<span class="sd">        Value of parameter being varied (e.g., lambda)</span>
<span class="sd">    parameter_range : list[float]</span>
<span class="sd">        Range of parameter values to be changed where the first value should be the value with which the system has been</span>
<span class="sd">        equilibrated.</span>
<span class="sd">    parameter_change : float</span>
<span class="sd">        The size of the step between parameter values, where a positive value increases and a negative value decreases.</span>
<span class="sd">        Take care that number of points needed to traverse the given range should result in an integer, otherwise</span>
<span class="sd">        LAMMPS will not end at the desired value.</span>
<span class="sd">    fix_adapt_changes : list</span>
<span class="sd">        A list of lists containing the following information from `fix adapt/fep &lt;https://docs.lammps.org/fix_adapt_fep.html&gt;`_:</span>
<span class="sd">        attribute (str), args (tuple), e.g., [[&quot;pair&quot;, (&quot;lj/cut/soft&quot;, &quot;lambda&quot;, 1, 2)]]. The attributes supported in LAMMPS are:</span>

<span class="sd">        - pair; arguments are: pair_style parameter solvent_type(s) solute_type(s)</span>

<span class="sd">            - pair_style (str) : String of LAMMPS pair style being changes</span>
<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">            - solvent_type (str) : String defining atom types in the solvent (no spaces), lists are denoted with an asterisk</span>
<span class="sd">            - solute_type (str) : String defining atom types in the solute (no spaces), lists are denoted with an asterisk</span>

<span class="sd">        - atom; arguments are: parameter atom_type(s). These lines will be scaled by the variation of a &quot;lambda&quot; parameter</span>
<span class="sd">            whose range is defined in `parameter_range`, where the starting and end points are multiplied by ``variable_initial``.</span>

<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">            - atom_type (str) : String defining atom types being affected, lists are denoted with an asterisk</span>
<span class="sd">            - variable_initial (float) : Specify the initial value of the variable</span>

<span class="sd">    temperature : float</span>
<span class="sd">        Temperature of the simulation. This will create a variable that is used in the FEP computes.</span>
<span class="sd">    output_frequency : int, default=1000</span>
<span class="sd">        Number of steps between thermo output and dump output.</span>
<span class="sd">    output_file : str, default=None</span>
<span class="sd">        File name and path for optional output file</span>
<span class="sd">    fix_adapt_changes2 : list, default=None</span>
<span class="sd">        A list of lists containing the following information from `fix adapt/fep &lt;https://docs.lammps.org/fix_adapt_fep.html&gt;`_:</span>
<span class="sd">        attribute (str), args (tuple). This option is useful when a parameter that has been varied and is set to another value</span>
<span class="sd">        in this simulation, e.g., lambda when the Coulomb potential is set to zero. Using this feature avoids complications</span>
<span class="sd">        with writing the pair potential information in the data file. The attributes supported in LAMMPS are:</span>

<span class="sd">        - pair; arguments are: pair_style parameter solvent_type(s) solute_type(s)</span>

<span class="sd">            - pair_style (str) : String of LAMMPS pair style being changes</span>
<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_</span>
<span class="sd">              for the options in your pair-potential</span>
<span class="sd">            - solvent_type (str) : String defining atom types in the solvent (no spaces), lists are denoted with an asterisk</span>
<span class="sd">            - solute_type (str) : String defining atom types in the solute (no spaces), lists are denoted with an asterisk</span>

<span class="sd">        - atom; arguments are: parameter atom_type(s). These lines will be scaled by the variation of a &quot;lambda&quot; parameter</span>
<span class="sd">            whose range is defined in `parameter_range`, where the starting and end points are multiplied by ``variable_initial``.</span>

<span class="sd">            - parameter (str) : Parameter being varied, see table in `compute</span>
<span class="sd">              fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options such as &quot;charge&quot;</span>
<span class="sd">            - atom_type (str) : String defining atom types being affected, lists are denoted with an asterisk</span>
<span class="sd">            - variable_initial (float) : Specify the initial value of the variable</span>

<span class="sd">    parameter2_value : float, default=None</span>
<span class="sd">        Value to set ``parameter2`` in ``fix_adapt_changes2``. Parameter that has been varied and is set to another value in this simulation, e.g., lambda when the Coulomb potential</span>
<span class="sd">        is set to zero. Using this feature avoids complications with writing the pair potential information in the data file.</span>
<span class="sd">        See table in `compute fep &lt;https://docs.lammps.org/compute_fep.html&gt;`_ for the options in your pair-potential</span>
<span class="sd">    parameter_array : list, default=None</span>
<span class="sd">        If not ``None``, this argument will overwrite the ``parameter_change`` argument and use the specified steps in</span>
<span class="sd">        the parameter. Note that the first value should represent the state that the trajectory is equilibrated at.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    file : list[str]</span>
<span class="sd">        List of strings representing lines in a file</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">parameter_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">parameter_change</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">parameter_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">parameter_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parameter_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parameter_change</span><span class="p">),</span> <span class="p">[</span><span class="n">parameter_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="p">)</span>
        <span class="n">flag_array</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parameter_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parameter_array</span><span class="p">)</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parameter_array</span><span class="p">]))</span>
        <span class="n">flag_array</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">nblocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nblocks</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">flag_array</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;If `parameter_array is not None`, an array of parameters must be provided, instead of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">parameter_array</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The argument `parameter_change` must be appropriately positive or negative to span the `parameter_range`&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">parameter2_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If fix_adapt_changes2 is provided, so must parameter2_value&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parameter2_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If parameter2_value is provided, so must fix_adapt_changes2&quot;</span><span class="p">)</span>

    <span class="n">_check_fix_adapt_changes_format</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="s2">&quot;kspace&quot;</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">_check_fix_adapt_changes_format</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">parameter2_value</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;kspace&quot;</span>

    <span class="n">file</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Variables and System Conditions</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable TK equal </span><span class="si">{</span><span class="n">temperature</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable freq equal </span><span class="si">{</span><span class="n">output_frequency</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable pinst equal press</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable tinst equal temp</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable vinst equal vol</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable pe equal pe</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable param equal </span><span class="si">{</span><span class="n">parameter_value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;variable lambdas vector [</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">decimals</span><span class="o">=</span><span class="n">prec</span><span class="p">))</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameter_array</span><span class="p">])</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">thermo $</span><span class="si">{freq}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Initialize computes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    variable paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_param</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Add previously changed parameter if it exists</span>
    <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Set Previous Change</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;variable param2 equal </span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;variable param2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*v_param2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fix ADAPT2 all adapt/fep 1 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param2A</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                    <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
                <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param2 &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;fix ADAPT all adapt/fep $</span><span class="si">{freq}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_paramA</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  v_param &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nblocks</span><span class="p">):</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">parameter_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">parameter_value</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">prec</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;variable delta</span><span class="si">{0:0d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; equal </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;variable deltaA</span><span class="si">{0:0d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> equal </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">*&quot;</span> <span class="o">+</span> <span class="s2">&quot;v_delta</span><span class="si">{0:0d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;compute FEP</span><span class="si">{0:03d}</span><span class="s2"> all fep &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{TK}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fix_adapt_changes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="s2">&quot;v_deltaA</span><span class="si">{0:0d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span><span class="p">:</span>
                    <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="n">arg1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="n">arg2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
                <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="s2">&quot;v_delta</span><span class="si">{0:0d}</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;    volume yes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;variable param</span><span class="si">{0:03d}</span><span class="s2"> equal v_param+v_delta</span><span class="si">{0:0d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;fix FEPout</span><span class="si">{0:03d}</span><span class="s2"> all&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot; ave/time $</span><span class="si">{freq}</span><span class="s2"> 1 $</span><span class="si">{freq}</span><span class="s2"> &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;v_param v_param</span><span class="si">{0:03d}</span><span class="s2"> v_param2 v_pe &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="s2">&quot;    c_FEP</span><span class="si">{0:03d}</span><span class="s2">[1] c_FEP</span><span class="si">{0:03d}</span><span class="s2">[2] c_FEP</span><span class="si">{0:03d}</span><span class="s2">[3]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; file files/mbar_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;_$</span><span class="si">{param}</span><span class="s2">_${param&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:03d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="o">+</span> <span class="s2">&quot;}_&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name2</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;    fix FEPout</span><span class="si">{0:03d}</span><span class="s2"> all&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot; ave/time $</span><span class="si">{freq}</span><span class="s2"> 1 $</span><span class="si">{freq}</span><span class="s2"> &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;v_param v_param</span><span class="si">{0:03d}</span><span class="s2"> v_pe &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="s2">&quot;        c_FEP</span><span class="si">{0:03d}</span><span class="s2">[1] c_FEP</span><span class="si">{0:03d}</span><span class="s2">[2] c_FEP</span><span class="si">{0:03d}</span><span class="s2">[3]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; file files/mbar_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;_$</span><span class="si">{param}</span><span class="s2">_${param&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:03d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="o">+</span> <span class="s2">&quot;}.txt</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fix_adapt_changes2</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">rerun files/dump_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">.lammpstrj every $</span><span class="si">{freq}</span><span class="s2"> dump x y z</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">rerun files/dump_</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">_&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;$</span><span class="si">{param}</span><span class="s2">_&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">parameter2_value</span><span class="si">}</span><span class="s2">.lammpstrj &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;every $</span><span class="si">{freq}</span><span class="s2"> dump x y z</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Generate Alchemical LAMMPS Inputs 0.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">generate_alchemical_lammps_inputs.generate_alchemical_lammps_inputs</a></li> 
      </ul>
    </div>

  
    <div class="footer" role="contentinfo">
    &#169; Copyright Works of NIST employees are not not subject to copyright protection in the United States.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
    </div>

  <!-- Taken from https://www.filamentgroup.com/lab/html-includes/#another-demo%3A-including-another-html-file -->
  <iframe src="../../_static/ntd2d_menu.html" onload="this.before((this.contentDocument.body||this.contentDocument).children[0]);this.remove()"></iframe>
  </body>
</html>